Java.perform(function () {

    // TrustManager (Android < 7 / 일부 앱)
    var X509TrustManager = Java.use('javax.net.ssl.X509TrustManager');
    var SSLContext = Java.use('javax.net.ssl.SSLContext');

    var TrustManager = Java.registerClass({
        name: 'dev.asd.TrustManager',
        implements: [X509TrustManager],
        methods: {
            checkClientTrusted: function (chain, authType) {},
            checkServerTrusted: function (chain, authType) {},
            getAcceptedIssuers: function () { return []; }
        }
    });

    var TrustManagers = [TrustManager.$new()];
    SSLContext.init.overload(
        '[Ljavax.net.ssl.KeyManager;',
        '[Ljavax.net.ssl.TrustManager;',
        'java.security.SecureRandom'
    ).implementation = function (km, tm, sr) {
        console.log('[+] SSLContext.init() bypass');
        this.init(km, TrustManagers, sr);
    };

    // OkHttp 3.x
    try {
        var CertificatePinner = Java.use('okhttp3.CertificatePinner');
        CertificatePinner.check.overload(
            'java.lang.String',
            'java.util.List'
        ).implementation = function (hostname, certs) {
            console.log('[+] OkHttp pinning bypass: ' + hostname);
            return;
        };
    } catch (e) {}

    // OkHttp 4.x (Kotlin)
    try {
        var CertPinner = Java.use('okhttp3.CertificatePinner');
        CertPinner.check.overload(
            'java.lang.String',
            'java.security.cert.Certificate'
        ).implementation = function (hostname, cert) {
            console.log('[+] OkHttp4 pinning bypass: ' + hostname);
            return;
        };
    } catch (e) {}

});